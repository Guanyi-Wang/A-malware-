package guanyi.todolist;

import android.content.ContentValues;
import android.database.sqlite.SQLiteDatabase;
import android.icu.text.SimpleDateFormat;
import android.os.Build;
import android.os.Bundle;
import android.support.annotation.RequiresApi;
import android.support.v7.app.AppCompatActivity;
import android.view.View;
import android.widget.EditText;
import android.widget.TextView;

import java.util.Date;

public class addTask extends AppCompatActivity {


    private EditText etTopic,etContent;
    private  int taskid = -1;// A flag to determine whether to modify or add a ask
    public static final String EXTRA_TASK_ID = "taskId";// The name of the flag mentioned before
    public static final String EXTRA_TASK_TOPIC = "taskTopic";
    public static final String EXTRA_TASK_CONTENT = "taskContent";
    private SQLiteDatabase dbWriter,dbReader;
    private TaskDB db;


    private View.OnClickListener bntClickHandler = new View.OnClickListener() {
        @RequiresApi(api = Build.VERSION_CODES.N)
        @Override
        public void onClick(View v) {
            switch (v.getId()){
                case R.id.bnt_Add:

                    saveTask();
                    setResult(RESULT_OK);
                    finish();

                    break;
                case R.id.bnt_cancel:

                    setResult(RESULT_CANCELED);
                    finish();

                    break;
            }
        }
    };

    @RequiresApi(api = Build.VERSION_CODES.N)
    public int saveTask(){

        ContentValues cv = new ContentValues();
//        SimpleDateFormat d = new SimpleDateFormat("yyyy-mm-dd hh:mm");
        cv.put(TaskDB.COLUMN_NAME_TOPIC,etTopic.getText().toString());
        cv.put(TaskDB.COLUMN_NAME_CONTENT,etContent.getText().toString());

        if (taskid>-1){

            dbWriter.update(TaskDB.TABLE_NAME,cv,TaskDB.COLUMN_NAME_ID+"=?",new String[]{taskid+""});
            return taskid;
        }else{
            return (int)dbWriter.insert(TaskDB.TABLE_NAME,null,cv);
        }

    }


    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_addtask);

        db = new TaskDB(this);
        dbReader = db.getReadableDatabase();
        dbWriter = db.getWritableDatabase();

        etContent = (EditText) findViewById(R.id.tvContent);
        etTopic = (EditText) findViewById(R.id.tvTopic);
        taskid = getIntent().getIntExtra(EXTRA_TASK_ID,-1);//default value -1

        if (taskid>-1){
            // Modify a task
            etTopic.setText(getIntent().getStringExtra(EXTRA_TASK_TOPIC));
            etContent.setText(getIntent().getStringExtra(EXTRA_TASK_CONTENT));
        }else{
            //Add a task
        }

        findViewById(R.id.bnt_Add).setOnClickListener(bntClickHandler);
        findViewById(R.id.bnt_cancel).setOnClickListener(bntClickHandler);
    }

    @Override
    protected void onDestroy() {

        dbReader.close();
        dbWriter.close();
        super.onDestroy();
    }
}
